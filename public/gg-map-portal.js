parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"d4e9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.wms=void 0;var t=require("leaflet/src/layer/Layer"),e=require("leaflet/src/layer/ImageOverlay"),r=require("leaflet/src/layer/tile/TileLayer.WMS"),i=require("leaflet/src/geo/crs/CRS.EPSG4326"),s=require("leaflet/src/geo/LatLngBounds"),n=o(require("leaflet/src/core/Util"));function a(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(a=function(t){return t?r:e})(t)}function o(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=a(e);if(r&&r.has(t))return r.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=s?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n]}return i.default=t,r&&r.set(t,i),i}var u={};exports.wms=u,u.Source=t.Layer.extend({options:{untiled:!0,identify:!0},initialize:function(t,e){n.setOptions(this,e),this.options.tiled&&(this.options.untiled=!1),this._url=t,this._subLayers={},this._overlay=this.createOverlay(this.options.untiled)},createOverlay:function(t){var e={};for(var r in this.options)"untiled"!=r&&"identify"!=r&&(e[r]=this.options[r]);return t?u.overlay(this._url,e):u.tileLayer(this._url,e)},onAdd:function(){this.refreshOverlay()},onRemove:function(){this._map&&this._overlay.removeFrom(this._map)},getEvents:function(){return this.options.identify?{click:this.identify}:{}},setOpacity:function(t){this.options.opacity=t,this._overlay&&this._overlay.setOpacity(t)},bringToBack:function(){this.options.isBack=!0,this._overlay&&this._overlay.bringToBack()},bringToFront:function(){this.options.isBack=!1,this._overlay&&this._overlay.bringToFront()},getLayer:function(t){return u.layer(this,t)},getSubLayers:function(){return this._subLayers},addSubLayer:function(t){this._subLayers[t]=!0,this.refreshOverlay()},removeSubLayer:function(t){delete this._subLayers[t],this.refreshOverlay()},replaceAllSubLayers:function(t){this._subLayers={};for(var e=0;e<t.length;e++)this._subLayers[t[e]]=!0;this.refreshOverlay()},refreshOverlay:function(){var t=Object.keys(this._subLayers).join(",");this._map&&(t?(this._overlay.setParams({layers:t}),this._overlay.addTo(this._map)):this._overlay.remove())},identify:function(t){var e=this.getIdentifyLayers();e.length&&this.getFeatureInfo(t.containerPoint,t.latlng,e,this.showFeatureInfo)},getFeatureInfo:function(t,e,r,i){var s=this.getFeatureInfoParams(t,r),a=this._url+n.getParamString(s,this._url);this.showWaiting(),this.ajax(a,function(t){this.hideWaiting();var r=this.parseFeatureInfo(t,a);i.call(this,e,r)})},ajax:function(t,e){u.ajax.call(this,t,e)},getIdentifyLayers:function(){return this.options.identifyLayers?this.options.identifyLayers:Object.keys(this._subLayers)},getFeatureInfoParams:function(t,e){var r,i;this.options.untiled?r=this._overlay.wmsParams:((i=this.createOverlay(!0)).updateWmsParams(this._map),(r=i.wmsParams).layers=e.join(","));var s={request:"GetFeatureInfo",query_layers:e.join(","),X:Math.round(t.x),Y:Math.round(t.y)};return n.extend({},r,s)},parseFeatureInfo:function(t,e){return"error"==t&&(t="<iframe src='"+e+"' style='border:none'>"),t},showFeatureInfo:function(t,e){this._map&&this._map.openPopup(e,t)},showWaiting:function(){this._map&&(this._map._container.style.cursor="progress")},hideWaiting:function(){this._map&&(this._map._container.style.cursor="default")}}),u.source=function(t,e){return new u.Source(t,e)},u.Layer=t.Layer.extend({initialize:function(t,e,r){n.setOptions(this,r),t.addSubLayer||(t=u.getSourceForUrl(t,r)),this._source=t,this._name=e},onAdd:function(){this._source._map||this._source.addTo(this._map),this._source.addSubLayer(this._name)},onRemove:function(){this._source.removeSubLayer(this._name)},setOpacity:function(t){this._source.setOpacity(t)},bringToBack:function(){this._source.bringToBack()},bringToFront:function(){this._source.bringToFront()}}),u.layer=function(t,e){return new u.Layer(t,e)},u.sources={},u.getSourceForUrl=function(t,e){return u.sources[t]||(u.sources[t]=u.source(t,e)),u.sources[t]},u.TileLayer=r.TileLayerWMS,u.tileLayer=r.tileLayerWMS,u.Overlay=t.Layer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},options:{crs:null,uppercase:!1,attribution:"",opacity:1,isBack:!1,minZoom:0,maxZoom:18},initialize:function(t,e){this._url=t;var r={},i={};for(var s in e)s in this.options?i[s]=e[s]:r[s]=e[s];n.setOptions(this,i),this.wmsParams=n.extend({},this.defaultWmsParams,r)},setParams:function(t){n.extend(this.wmsParams,t),this.update()},getAttribution:function(){return this.options.attribution},onAdd:function(){this.update()},onRemove:function(t){this._currentOverlay&&(t.removeLayer(this._currentOverlay),delete this._currentOverlay),this._currentUrl&&delete this._currentUrl},getEvents:function(){return{moveend:this.update}},update:function(){if(this._map){this.updateWmsParams();var t=this.getImageUrl();if(this._currentUrl!=t){this._currentUrl=t;var r=this._map.getBounds(),i=new e.ImageOverlay(t,new s.LatLngBounds(r.getNorthEast(),r.getSouthWest()),{opacity:0});i.addTo(this._map),i.once("load",function(){if(!this._map)return;if(i._url!=this._currentUrl)return void this._map.removeLayer(i);this._currentOverlay&&this._map.removeLayer(this._currentOverlay);this._currentOverlay=i,i.setOpacity(this.options.opacity?this.options.opacity:1),!0===this.options.isBack&&i.bringToBack();!1===this.options.isBack&&i.bringToFront()},this),(this._map.getZoom()<this.options.minZoom||this._map.getZoom()>this.options.maxZoom)&&this._map.removeLayer(i)}}},setOpacity:function(t){this.options.opacity=t,this._currentOverlay&&this._currentOverlay.setOpacity(t)},bringToBack:function(){this.options.isBack=!0,this._currentOverlay&&this._currentOverlay.bringToBack()},bringToFront:function(){this.options.isBack=!1,this._currentOverlay&&this._currentOverlay.bringToFront()},updateWmsParams:function(t){t||(t=this._map);var e=t.getBounds(),r=t.getSize(),s=parseFloat(this.wmsParams.version),a=this.options.crs||t.options.crs,o=s>=1.3?"crs":"srs",u=a.project(e.getNorthWest()),c=a.project(e.getSouthEast()),h={width:r.x,height:r.y};h[o]=a.code,h.bbox=(s>=1.3&&a.code===i.EPSG4326.code?[c.y,u.x,u.y,c.x]:[u.x,c.y,c.x,u.y]).join(","),n.extend(this.wmsParams,h)},getImageUrl:function(){var t=this.options.uppercase||!1,e=n.getParamString(this.wmsParams,this._url,t);return this._url+e}}),u.overlay=function(t,e){return new u.Overlay(t,e)},u.ajax=function(t,e){var r=this,i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(200===i.status?e.call(r,i.responseText):e.call(r,"error"))},i.open("GET",t),i.send()};
},{}],"AJBR":[function(require,module,exports) {
"use strict";require("leaflet"),require("leaflet.markercluster");var e=r(require("leaflet/dist/images/marker-icon.png")),t=r(require("leaflet/dist/images/marker-shadow.png")),a=i(require("bootstrap")),s=require("js-yaml"),n=require("./leaflet.wms.js");function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(o=function(e){return e?a:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=o(t);if(a&&a.has(e))return a.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var r=n?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(s,i,r):s[i]=e[i]}return s.default=e,a&&a.set(e,s),s}function r(e){return e&&e.__esModule?e:{default:e}}let l=document.createElement("template");l.innerHTML='\n  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"\n    integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"\n    crossorigin="anonymous">\n  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"\n    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"\n    crossorigin="anonymous">\n  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"\n    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="\n    crossorigin="">\n  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" media="screen">\n  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" media="screen">\n  <style>\n    #map {\n      width: 100vw;\n        height: 100vh;\n        padding: 0;\n        margin: 0;\n    }\n\n    :host {\n      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif;\n      --primary-color: #003d7d;\n      --secondary-color: #ff4b5f;\n    }\n\n    main.card {\n      position: absolute;\n      left: 15px;\n      top: 15px;\n      bottom: 15px;\n      width: 300px;\n      z-index: 1005;\n\n      background-color: #fff;\n      box-shadow: 0 8px 10px 1px rgba(0, 0, 0, 0.14), 0 3px 14px 2px rgba(0, 0, 0, 0.12), 0 5px 5px -3px rgba(0, 0, 0, 0.3);\n\n      transition: transform 175ms;\n    }\n\n    a {\n      color: var(--primary-color, inherit);\n    }\n\n    .btn-primary {\n      color: #fff;\n      background-color: var(--primary-color, inherit);\n      border-color: var(--primary-color, inherit);\n    }\n\n    header#page-title {\n      padding: 10px;\n      background-color: var(--primary-color);\n    }\n\n    header#page-title h1 {\n      color: #fff;\n      font-weight: 700;\n      font-size: xx-large;\n    }\n\n    section#overlays {\n      overflow: auto;\n      padding-bottom: 5px;\n      overflow-y:scroll;\n    }\n\n    section#overlays .overlay-item {\n      font-size: 1.1rem;\n      color: #444;\n    }\n\n    section#overlays .overlay-item:hover {\n      cursor: pointer;\n      background-color: #eee;\n    }\n\n    section#overlays .overlay-item.selected {\n      background-color: #ddd;\n      color: var(--primary-color);\n\n      /* left border and offset text back */\n      border-left: 0.25rem solid var(--primary-color);\n      padding-left: 1rem;\n    }\n\n    ul.overlay-layers>li.list-group-item {\n      border: 0;\n      border-left: 0.25rem solid var(--primary-color);\n      padding-left: 1.75rem;\n      background-color: #eee;\n      cursor: pointer;\n    }\n\n    ul.overlay-layers .overlay-layers-toggle {\n      --primary-color: var(--secondary-color);\n    }\n\n    button#layers-menu-toggle {\n      position: absolute;\n      display: none;\n      right: 10px;\n      bottom: 90px;\n      width: 160px;\n      height: 90px;\n      z-index: 1001;\n      border: 2px solid #ffffff;\n      box-shadow: 0 2px 2px 1px rgba(0, 0, 0, 0.14), 0 1px 3px 1px rgba(0, 0, 0, 0.12), 0 2px 2px -1px rgba(0, 0, 0, 0.3);\n      cursor: pointer;\n    }\n\n    section#download-disclaimer {\n      max-height: 400px;\n      overflow: auto;\n      text-align: justify;\n    }\n\n    .show-mobile {\n      display: none;\n    }\n\n    @media (max-width: 600px) {\n      main.card {\n        right: 30px;\n        left: 30px;\n        top: 30px;\n        bottom: 30px;\n        width: unset;\n        transform: scale(0);\n      }\n\n      main.show {\n        transform: scale(1);\n      }\n\n      .show-mobile {\n        display: block;\n      }\n\n      button#layers-menu-toggle {\n        display: block;\n        width: 48px;\n        height: 48px;\n        border-radius: 5px;\n      }\n    }\n\n    .switch {\n      position: relative;\n      display: inline-block;\n      width: 40px;\n      height: 30px;\n      margin-right: 12px;\n      padding-right: 40px;\n    }\n\n    /* Hide default HTML checkbox */\n    .switch input {\n      opacity: 0;\n      width: 0;\n      height: 0;\n    }\n\n    /* The slider */\n    .slider {\n      position: absolute;\n      cursor: pointer;\n      top: 0;\n      left: -16px;\n      right: 0;\n      bottom: 0;\n      background-color: #ccc;\n      border-radius: 30px;\n      -webkit-transition: .4s;\n      transition: .4s;\n    }\n\n    .slider:before {\n      position: absolute;\n      content: "";\n      height: 22px;\n      width: 22px;\n      left: 4px;\n      bottom: 4px;\n      background-color: white;\n      border-radius: 50%;\n      -webkit-transition: .4s;\n      transition: .4s;\n    }\n\n    input:checked + .slider {\n      background-color: var(--primary-color);\n    }\n\n    input:focus + .slider {\n      box-shadow: 0 0 1px #2196F3;\n    }\n\n    input:checked + .slider:before {\n      -webkit-transform: translateX(26px);\n      -ms-transform: translateX(26px);\n      transform: translateX(26px);\n    }\n\n    .accordion-button:focus {\n      box-shadow: none;\n    }\n\n    .accordion-button:not(.collapsed)::after {\n      background-image: url("data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 16 16\' fill=\'%23003d7d\'%3e%3cpath fill-rule=\'evenodd\' d=\'M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\'/%3e%3c/svg%3e");\n    }\n\n    .collapsing {\n      -webkit-transition: none;\n      transition: none;\n      display: none;\n    }\n  </style>\n\n  <main id="layers-menu" class="card">\n    <header id="page-title" class="card-img-top d-flex align-items-end">\n      <h1 id="map-title" class="h2"></h1>\n    </header>\n\n    \x3c!-- Search section --\x3e\n    <section id="search-section" class="input-group">\n      <input type="text" name="search" id="search" class="form-control rounded-0" placeholder="Search address">\n      <span class="input-group-btn rounded-0">\n        <button class="btn btn-secondary rounded-0">\n          <i class="fa fa-fw fa-search"></i>\n        </button>\n      </span>\n    </section>\n\n    \x3c!-- List of available overlays --\x3e\n    <section id="overlays"></section>\n\n    <footer class="card-body">\n      \x3c!-- <a href="#" class="btn btn-link">Help</a>\n      <a href="#" class="btn btn-link">Tour</a> --\x3e\n      <div class="pull-right show-mobile">\n        <a href="#" class="btn btn-primary menu-toggle">\n          <i class="fa fa-map"></i>\n          View Map\n        </a>\n      </div>\n    </footer>\n  </main>\n\n  <button id="layers-menu-toggle" class="btn btn-primary menu-toggle"><i class="fa fa-bars"></i></button>\n\n  <div id="map"></div>\n\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"\n    integrity="sha512-nnzkI2u2Dy6HMnzMIkh7CPd1KX445z38XIu4jG1jGw7x5tSL3VBjE44dY4ihMU1ijAQV930SPM12cCFrB18sVw=="\n    crossorigin="anonymous"\n    referrerpolicy="no-referrer"><\/script>\n  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js"\n    integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/"\n    crossorigin="anonymous"><\/script>\n';let h=document.createElement("template");h.innerHTML='\n  <div class="modal fade" id="download-modal" tabindex="-1" role="dialog" aria-labelledby="download-modal-label" aria-hidden="true">\n    <div class="modal-dialog modal-lg" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3 class="modal-title" id="download-modal-label">\n            <span id="layer-name"></span>\n          </h3>\n          <button type="button" id="modal-close" class="btn-close" data-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <section style="height: 400px; overflow: auto; padding: 10px; background-color: #eee; font-size: 0.85rem;">\n            <h5>Download Disclaimer</h5>\n\n            <p>The City of Garden Grove provides the data as a public resource of general information for use "as is." The City\n              of Garden Grove provides this information with the understanding that it is not guaranteed to be accurate, correct\n              or complete and any conclusions drawn from such information are the sole responsibility of the user. Further,\n              the City of Garden Grove makes no warranty, representation or guaranty as to the content, sequence, accuracy,\n              timeliness or completeness of any of the spatial or database information provided herein. While every effort\n              has been made to ensure the content, sequence, accuracy, timeliness or completeness of materials presented within\n              these pages, the City of Garden Grove assumes no responsibility for errors or omissions, and explicitly disclaims\n              any representations and warranties, including, without limitation, the implied warranties of merchantability\n              and fitness for a particular purpose. The City of Garden Grove shall assume no liability for:</p>\n            <p>1.Any errors, omissions, or inaccuracies in the information provided, regardless of how caused; or 2.Any decision\n              made or action taken or not taken by viewer in reliance upon any information or data furnished hereunder.</p>\n            <p>Availability of the City of Garden Grove GIS is not guaranteed. Applications, servers, and network connections\n              may be unavailable at any time for maintenance or unscheduled outages. Outages may be of long duration. Users\n              are cautioned to create dependencies on these services for critical needs.</p>\n            <p>THE FOREGOING WARRANTY IS EXCLUSIVE AND IN LIEU OF ALL OTHER WARRANTIES OF MERCHANTABILITY, FITNESS FOR PARTICULAR\n              PURPOSE AND/OR ANY OTHER TYPE WHETHER EXPRESSED OR IMPLIED. In no event shall The City of Garden Grove become\n              liable to users of these data, or any other party, for any loss or direct, indirect, special, incidental or consequential\n              damages, including, but not limited to, time, money or goodwill, arising from the use or modification of the\n              data.\n            </p>\n            <p>To assist The City of Garden Grove in the maintenance and/or correction of the data, users should provide the City\n              of Garden Grove with information concerning errors or discrepancies found in using the data. Please acknowledge\n              the City of Garden Grove as the source when data is used in the preparation of reports, papers, publications,\n              maps, or other products.</p>\n          </section>\n        </div>\n        <div class="modal-footer">\n          <span id="download-buttons-label">Download as:</span>\n        </div>\n      </div>\n    </div>\n  </div>\n';class d extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(l.content.cloneNode(!0)),this.hasAttribute("config")?this.config=this.getAttribute("config"):console.error("Error: No map configuration specificied."),this.state={baseMap:"",overlay:0,layers:[]},this.baseMaps={},this.baseMapNames={},this.wmsGroups={},this.geojsonLayers={},this.overlayCollapses={},this._markersGroup=L.featureGroup([]),window.onpopstate=function(){let e=this.baseMapNames[this.state.baseMap];this._initializeState(location.hash),e!==this.baseMapNames[this.state.baseMap]&&(this.baseMaps[e].removeFrom(this.map),this.baseMaps[this.baseMapNames[this.state.baseMap]].addTo(this.map)),this.overlayMaps[this.state.overlay]||(this.state.overlay=0,console.warn(`Warning: The overlay requested in the URL does not exist. Defaulting to ${this.overlayMaps[0].name}.`),this._pushState()),this.selectedOverlay.machineName!==this.overlayMaps[this.state.overlay].machineName&&this.toggleCollapse(this.overlayMaps[this.state.overlay].machineName),this.overlaySelect(this.state.overlay)}.bind(this)}connectedCallback(){fetch(this.config).then(e=>e.text()).then(this.initializeMap.bind(this))}initializeMap(e){let t;try{t=(0,s.load)(e)}catch(a){return void console.error("Error: Cannot load config file. Please ensure config.yml exists")}this.mapProperties=t.mapProperties,this.downloadProperties=t.downloadProperties,this.overlayMaps=t.overlayMaps,this.initializeSearch(t.searchUrl),this.overlayMaps&&1===this.overlayMaps.length&&(this.flat=!0),this.mapTitle=this.mapProperties.title?this.mapProperties.title:"Map Portal",this.shadowRoot.getElementById("map-title").textContent=this.mapTitle,document.title=this.mapTitle,this.mapProperties.options?this.mapProperties.options.center&&this.mapProperties.options.zoom||console.warn("Warning: Intial center and zoom of map are not set. These options can be input in the config file under mapProperties.options"):console.warn("Warning: No map options given, please provide leaflet map options in the config file under mapProperties.options"),this.map=L.map(this.shadowRoot.getElementById("map"),this.mapProperties.options),this.mapProperties.bounds&&this.map.fitBounds(this.mapProperties.bounds),this.map.zoomControl.setPosition("topright"),this.mapProperties.attributionPrefix&&this.map.attributionControl.setPrefix(this.mapProperties.attributionPrefix),this.shadowRoot.querySelectorAll(".menu-toggle").forEach(e=>e.onclick=this._toggleLayersMenu.bind(this)),this._markersGroup.addTo(this.map),this._initializeState(decodeURI(location.hash)),this._initializeBaseMaps(t.baseMaps),this._initializeOverlays(t.wmsDefaultSource)}initializeSearch(e){if(!e)return void console.error("Error: No URL given for address search. Please input URL in config file under searchUrl");this.shadowRoot.getElementById("search").oninput=function(e){e.target.value||(this._markersGroup.clearLayers(),this.map&&(this.selectedOverlay.initialCenter&&this.selectedOverlay.initialZoom?(this.map.flyTo(this.selectedOverlay.initialCenter,this.selectedOverlay.initialZoom),this.selectedOverlay.fitBounds&&(window.innerWidth<=600?this.map.flyToBounds(this.mapProperties.bounds):this.map.flyToBounds(this.mapProperties.bounds,{paddingTopLeft:[250,0],paddingBottomRight:[-50,0]}))):(this.map.flyTo(this.mapProperties.mapOptions.center,this.mapProperties.zoom),this.mapProperties.bounds&&this.map.fitBounds(this.mapProperties.bounds))))}.bind(this),jQuery("#search",this.shadowRoot).autocomplete({preventBadQueries:!1,deferRequestBy:200,minChars:3,serviceUrl:e,paramName:"q",transformResult:function(e){return{suggestions:JSON.parse(e).addresses.map(e=>({value:e.address,data:e}))}},onSearchStart:()=>this.searchMakers=[],onSearchComplete:function(e,t){this.searchMarkers=t.map(e=>({coords:[e.data.latitude,e.data.longitude],address:e.data.address})),this._markMap(this.searchMarkers)}.bind(this),onSelect:function(e){this.searchMarkers=[{coords:[e.data.latitude,e.data.longitude],address:e.data.address}],this._markMap(this.searchMarkers)}.bind(this)})}_initializeState(e){if(""!==e){let t=e.substring(2).split("/");t[0]&&(this.state.baseMap=t[0]),t[1]&&this.overlayMaps&&(this.state.overlay=this.overlayMaps.findIndex(e=>e.machineName===t[1])),-1!==this.state.overlay||isNaN(parseInt(t[1]))||(this.state.overlay=parseInt(t[1])),t[2]&&(this.state.layers=t[2].split(","))}}_initializeBaseMaps(e){if(!e||!e.length)return alert("No basemaps provided."),void console.error("Error: Please list basemap configuration properties in the config file as baseMaps[]");for(let t=0;t<e.length;t++){let a=e[t];if(a.machineName||(a.name||(a.name="Basemap "+t),a.machineName=t),this.baseMapNames[a.machineName]=a.name,a.source){switch(a.options?!a.options.maxZoom&&this.mapProperties.options&&(a.options.maxZoom=this.mapProperties.options.maxZoom):console.warn(`Warning: No basemap options given for ${a.name}, please provide leaflet basemap options in the config file under baseMaps[].options`),a.format){case"XYZ":this.baseMaps[a.name]=L.tileLayer(a.source,a.options);break;case"WMS":a.options.format||(a.options.format="image/png"),this.baseMaps[a.name]=L.tileLayer.wms(a.source,a.options);break;default:console.error(`Error: Invalid Tile Layer Format for ${a.name}: ${a.format}. Please check baseMaps[].format in config file`);continue}this.baseMaps[a.name].on("tileerror",function(){console.error(`Error: Unable to load basemap layer ${a.name}, check source and options for baseMaps[] in config file`)}),!this.state.baseMap&&a.default&&(this.state.baseMap=a.machineName)}else console.error(`Error: No basemap source provided for ${a.name}, please provide source URL in the config file under baseMaps[].source`)}Object.keys(this.baseMaps).length&&(this.state.baseMap&&this.baseMaps[this.baseMapNames[this.state.baseMap]]||(this.state.baseMap=Object.keys(this.baseMapNames).find(e=>this.baseMapNames[e]===Object.keys(this.baseMaps)[0]),console.warn(`Warning: The basemap requested in the URL does not exist. Defaulting to ${this.baseMapNames[this.state.baseMap]}.`),this._pushState()),this.baseMaps[this.baseMapNames[this.state.baseMap]].addTo(this.map),L.control.layers(this.baseMaps).addTo(this.map).setPosition("bottomright"),this.map.on("baselayerchange",function(e){let t=Object.keys(this.baseMapNames).find(t=>this.baseMapNames[t]===e.name);this.state.baseMap!==t&&(this.state.baseMap=t,this._pushState())}.bind(this)))}_initializeOverlays(e){if(!this.overlayMaps||!this.overlayMaps.length)return alert("No overlay layers provided."),void console.error("Error: Please list overlay configuration properties in the config file as overlayMaps[]");e||console.warn("Warning: wmsDefaultSource not set in config file. Layers may not display");let t=document.createElement("div");t.classList.add("accordion","accordion-flush"),this.shadowRoot.getElementById("overlays").appendChild(t);for(let s=0;s<this.overlayMaps.length;s++){let n=this.overlayMaps[s];if(!this.state.overlay&&n.default&&(this.state.overlay=s),n.machineName||(this.overlayMaps[s].machineName=s),n.name||(this.overlayMaps[s].name="Overlay "+s),!n.layers||!Object.keys(n.layers).length)return void console.error(`Error: Overlay ${this.overlayMaps[s].name} does not have any layers. Please set them in the config file under overlayMaps[].layers`);let o=document.createElement("template");o.innerHTML=`\n        <div class='accordion-item'>\n          <h2 class='accordion-header' id=${n.machineName}>\n            <button class='overlay-item accordion-button collapsed' id=${s} type='button' value=${n.machineName}>\n              ${n.name}\n            </button>\n          </h2>\n          <div class='accordion-collapse collapse' id=${n.machineName+"-layers"}>\n            <ul class='overlay-layers list-group list-group-flush'>\n            </ul>\n          </div>\n        </div>\n      `;let i=o.content.firstElementChild.cloneNode(!0);i.querySelector("h2").title=n.description?n.description:this.overlayMaps[s].name,i.querySelector("button").onclick=this._toggleOverlay.bind(this),t.appendChild(i);let r=this.shadowRoot.getElementById(n.machineName+"-layers");this.overlayCollapses[n.machineName]=new a.Collapse(r,{toggle:!1});let l=function(e){this.shadowRoot.getElementById(e.target.id.slice(0,-7)).querySelector("button").disabled=!0}.bind(this),h=function(e){this.shadowRoot.getElementById(e.target.id.slice(0,-7)).querySelector("button").disabled=!1}.bind(this);r.addEventListener("show.bs.collapse",l),r.addEventListener("hide.bs.collapse",l),r.addEventListener("shown.bs.collapse",h),r.addEventListener("hidden.bs.collapse",h);let d=i.querySelector("ul"),c=this.overlayMaps[s].layers;this.overlayMaps[s].flattenedLayers=[];for(let t in c){for(let a=0;a<c[t].length;a++){c[t][a].interaction=t;let n=c[t][a];if(n.machineName||(c[t][a].machineName=t+s+a),n.name||(c[t][a].name=`${t} layer ${s}.${a}`),"alwaysOn"===t)c[t][a].visible=!0;else{let e=document.createElement("template");e.innerHTML=`\n              <li class='list-group-item d-flex justify-content-start' id=${n.machineName}>\n                <label class='switch'>\n                  <input type='checkbox' class='overlay-layers-toggle' disabled>\n                  <span class='slider'></span>\n                </label>\n                <span class='mr-auto'>${n.name}</span>\n                <a href='#' class='ms-auto'>\n                  <i class='fa fa-fw fa-download' title=${"Download "+n.name}></i>\n                </a>\n              </li>\n            `;let t=e.content.firstElementChild.cloneNode(!0);t.onclick=function(){this._toggleLayer(n.machineName)}.bind(this),t.querySelector("a").onclick=function(e){e.stopPropagation(),e.preventDefault(),this._downloadLayer(n)}.bind(this),d.appendChild(t)}"wms"!==c[t][a].type&&void 0!==c[t][a].type||void 0!==c[t][a].source||(c[t][a].type="wms",c[t][a].source=e)}this.overlayMaps[s].flattenedLayers=this.overlayMaps[s].flattenedLayers.concat(c[t])}}location.hash||this.overlayMaps[this.state.overlay].flattenedLayers.filter(e=>e.visible&&"alwaysOn"!==e.interaction).forEach(e=>{this.state.layers.push(e.machineName.split(".")[1])}),this.overlayMaps[this.state.overlay]||(this.state.overlay=0,console.warn(`Warning: The overlay requested by the URL does not exist. Defaulting to ${this.overlayMaps[0].name}.`),this._pushState()),this.toggleCollapse(this.overlayMaps[this.state.overlay].machineName),this.overlaySelect(this.state.overlay)}_toggleOverlay(e){let t=e.target,a=t.getAttribute("value");if(this.flat||this.toggleCollapse(a),t.classList.contains("collapsed"))this.selectedOverlay.collapsed=!0;else{let e=t.getAttribute("id");this.state.overlay===e&&location.hash||(this.state.overlay=e,this.state.layers=[],this.overlayMaps[e].flattenedLayers.filter(e=>e.visible&&"alwaysOn"!==e.interaction).forEach(e=>{this.state.layers.push(e.machineName.split(".")[1])})),this.overlaySelect(this.state.overlay),this._pushState()}}_toggleLayer(e){let t=this.selectedOverlay.flattenedLayers.findIndex(t=>t.machineName===e&&"alwaysOn"!==t.interaction),a=this.selectedOverlay.flattenedLayers[t],s=e.split(".")[1],n=a.visible;if("exclusives"===a.interaction&&!n){for(let e=0;e<this.selectedOverlay.flattenedLayers.length;e++)"exclusives"===this.selectedOverlay.flattenedLayers[e].interaction&&(this.selectedOverlay.flattenedLayers[e].visible=!1);this.state.layers=[]}if(n){let e=this.state.layers.indexOf(s);e>-1&&this.state.layers.splice(e,1)}else this.state.layers.push(s);this.selectedOverlay.flattenedLayers[t].visible=!n,this._parseLayers(),this._pushState()}toggleCollapse(e){let t=this.shadowRoot.getElementById(e).getElementsByTagName("button")[0];t.classList.toggle("collapsed"),t.classList.toggle("selected"),this.overlayCollapses[e].toggle()}overlaySelect(e){this.selectedOverlay!==this.overlayMaps[e]&&(this.selectedOverlay&&!this.selectedOverlay.collapsed&&this.toggleCollapse(this.selectedOverlay.machineName),this.selectedOverlay=this.overlayMaps[e]),this.selectedOverlay.collapsed=!1,this._parseLayers(),this.selectedOverlay.resetViewOnSelect&&this.map.flyTo(this.selectedOverlay.initialCenter,this.selectedOverlay.initialZoom),this.selectedOverlay.fitBounds&&(window.innerWidth<=600?this.map.flyToBounds(this.mapProperties.bounds):this.map.flyToBounds(this.mapProperties.bounds,{paddingTopLeft:[250,0],paddingBottomRight:[-50,0]}))}async _parseLayers(){let e=this.selectedOverlay.flattenedLayers,t={};this._syncStateLayers(),e.filter(e=>e.visible).forEach(async e=>{if("wms"===e.type)t[e.source]=t[e.source]||{layers:[]},t[e.source].layers.push(e.machineName);else if("geojson"===e.type&&!this.geojsonLayers[e.machineName]){let t=await fetch(e.source);t.ok||console.error(`Error: The source for GeoJSON layer ${e.name} could not be fetched. Status: ${t.status}`);let a=await t.json();this._createGeoJSONLayer(e,a)}}),e.forEach(e=>{let t=this.shadowRoot.getElementById(e.machineName);if(t){let a=t.getElementsByTagName("input")[0];e.visible&&"alwaysOn"!==e.interaction?(a.checked=!0,this.geojsonLayers[e.machineName]&&this.geojsonLayers[e.machineName].addTo(this.map)):(a.checked=!1,this.geojsonLayers[e.machineName]&&this.geojsonLayers[e.machineName].removeFrom(this.map))}});for(let a in t)this.wmsGroups[a]||(this.wmsGroups[a]=n.wms.source(a,{format:"image/png",transparent:!0,identify:!1}),this.wmsGroups[a].addTo(this.map)),this.wmsGroups[a].replaceAllSubLayers(t[a].layers);for(let a in this.wmsGroups)a in t||this.wmsGroups[a].removeFrom(this.map)}_pushState(){let e=this.overlayMaps?this.overlayMaps[this.state.overlay].machineName:"",t=this.state.layers.join(),a="#".concat("/",this.state.baseMap,"/",e);t&&(a=a.concat("/",t)),history.pushState?history.pushState(this.state,"",a):location.hash=a}_syncStateLayers(){let e=[];for(let t=0;t<this.selectedOverlay.flattenedLayers.length;t++){let a=this.selectedOverlay.flattenedLayers[t],s=a.machineName.split(".")[1];if("alwaysOn"!==a.interaction)if(this.state.layers.includes(s))if("exclusives"===a.interaction&&this.state.layers.length>1){let e=this.state.layers.findIndex(e=>e===s);if(0===e)return this.state.layers=[s],this.selectedOverlay.flattenedLayers[t].visible=!0,console.warn(`Warning: The layer ${s} is exclusive. All other layers have been removed.`),void this._pushState();this.state.layers.splice(e,1),console.warn(`Warning: The layer ${s} is exclusive and has been removed.`),this._pushState()}else this.selectedOverlay.flattenedLayers[t].visible=!0,e.push(s);else this.selectedOverlay.flattenedLayers[t].visible=!1}if(e.length<this.state.layers.length){let t=this.state.layers.filter(t=>!e.includes(t));this.state.layers=e,console.warn(`Warning: The following layer(s) do not exist in current overlay: ${t.join(", ")}.`),this._pushState()}}_createGeoJSONLayer(e,t){let a;e.cluster&&(a=L.markerClusterGroup({showCoverageOnHover:!1,maxClusterRadius:e.maxClusterRadius?e.maxClusterRadius:80}));let s={pointToLayer:function(t,s){let n=L.circleMarker(s,e.markerStyle);return e.identify&&n.bindPopup(this._generatePopupContent(t)),e.cluster&&a.addLayer(n),n}.bind(this),attribution:e.attribution},n=L.geoJSON(t,s);e.cluster?this.geojsonLayers[e.machineName]=a:this.geojsonLayers[e.machineName]=n,this.geojsonLayers[e.machineName].addTo(this.map)}_generatePopupContent(e){let t="";for(let a in e.properties){t+=`<tr><td>${a.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase().replace("_"," ")})}:</td><td><strong>${e.properties[a]}</strong></td></tr>`}return`<table>${t}</table>`}_markMap(a){this._markersGroup.clearLayers(),0!==a.length&&(a.forEach(a=>{this._markersGroup.addLayer(L.marker(a.coords,{icon:L.icon({iconUrl:e.default,shadowUrl:t.default,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]})}).bindPopup(a.address))}),1===a.length?this.map.flyTo(a[0].coords):this.map.fitBounds(this._markersGroup.getBounds()))}_toggleLayersMenu(){this.shadowRoot.querySelector("main#layers-menu").classList.toggle("show")}_downloadLayer(e){let t=this.shadowRoot;t.appendChild(h.content.cloneNode(!0));let s=new a.Modal(t.getElementById("download-modal"));t.getElementById("modal-close").onclick=(()=>s.hide());let n=this.downloadProperties.source+e.machineName;t.getElementById("layer-name").textContent=e.name;let o=t.querySelector(".modal-footer");this.downloadProperties.options&&this.downloadProperties.options.length?(this.downloadProperties.options.forEach(e=>{let t=document.createElement("template");t.innerHTML=`\n        <a href=${n+e.formatUrl} target='_blank' class='btn btn-secondary'>\n          <i class='fa fa-download'></i> ${e.type}\n        </a>\n      `,o.appendChild(t.content.cloneNode(!0))}),s.show()):console.error("Error: No download options given. Please specify in the config file under downloadProperties.options")}}customElements.define("gg-map-portal",d);
},{"./leaflet.wms.js":"d4e9"}]},{},["AJBR"], null)
//# sourceMappingURL=gg-map-portal.js.map